<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>INOVA SENAI â€” Assistente IA</title>
    <meta name="description" content="INOVA SENAI â€” Assistente de inteligÃªncia artificial do SENAI.">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <!-- Favicon -->
    <link rel="icon" href="img/SENAI-AI 1.png" type="image/png">

    <!-- PWA -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#dd203c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="INOVA SENAI">

    <!-- Estilos -->
    <link rel="stylesheet" href="style.css">
    <!-- Mermaid.js -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.min.js"></script>
</head>

<body class="dark-mode">

    <!-- Focus Mode Exit Hint -->
    <div class="focus-exit-hint" id="focus-exit-hint">
        <i class="fas fa-compress"></i> Sair do Modo Foco (Esc)
    </div>

    <!-- Sidebar -->
    <aside class="sidebar expanded" id="sidebar">
        <div class="sidebar-top">
            <button class="sidebar-btn" id="new-chat" title="Novo chat (Ctrl+N)">
                <i class="fas fa-plus"></i>
            </button>
            <button class="sidebar-btn" id="focus-btn" title="Modo Foco">
                <i class="fas fa-expand"></i>
            </button>
            <button class="sidebar-btn sidebar-toggle" id="sidebar-toggle" title="Recolher sidebar">
                <i class="fas fa-bars"></i>
            </button>
        </div>

        <!-- Chat History -->
        <div class="chat-history" id="chat-history">
            <div class="chat-history-label">Conversas</div>
            <div class="chat-search-wrap">
                <i class="fas fa-search"></i>
                <input type="text" id="chat-search" placeholder="Buscar conversa... (Ctrl+K)" autocomplete="off">
            </div>
            <div class="tag-filter-bar" id="tag-filter-bar">
                <button class="tag-pill active" data-tag="all">Todos</button>
                <button class="tag-pill" data-tag="trabalho">ðŸ’¼ Trabalho</button>
                <button class="tag-pill" data-tag="estudo">ðŸ“š Estudo</button>
                <button class="tag-pill" data-tag="codigo">ðŸ’» CÃ³digo</button>
                <button class="tag-pill" data-tag="geral">ðŸ“¦ Geral</button>
            </div>
            <div class="chat-history-list" id="chat-history-list">
                <!-- Populated dynamically -->
            </div>
        </div>

        <div class="sidebar-bottom">
            <div class="export-wrap">
                <button class="sidebar-btn" id="export-chat" title="Exportar conversa">
                    <i class="fas fa-download"></i>
                </button>
                <div class="export-dropdown" id="export-dropdown">
                    <div class="export-option" data-format="txt"><i class="fas fa-file-alt"></i> TXT</div>
                    <div class="export-option" data-format="md"><i class="fab fa-markdown"></i> Markdown</div>
                    <div class="export-option" data-format="pdf"><i class="fas fa-file-pdf"></i> PDF</div>
                </div>
            </div>
            <button class="sidebar-btn" id="templates-btn" title="Prompt Templates">
                <i class="fas fa-magic"></i>
            </button>
            <button class="sidebar-btn" id="agents-btn" title="Agentes Especializados">
                <i class="fas fa-user-cog"></i>
            </button>
            <button class="sidebar-btn" id="share-chat" title="Compartilhar conversa">
                <i class="fas fa-share-alt"></i>
            </button>
            <div class="theme-selector-wrap">
                <button class="sidebar-btn" id="theme-selector-btn" title="Temas">
                    <i class="fas fa-palette"></i>
                </button>
                <div class="theme-dropdown" id="theme-dropdown">
                    <div class="theme-option" data-theme="dark"><span class="theme-dot"
                            style="background:#0f0f1a"></span> Dark</div>
                    <div class="theme-option" data-theme="light"><span class="theme-dot"
                            style="background:#ffffff"></span> Light</div>
                    <div class="theme-option" data-theme="midnight"><span class="theme-dot"
                            style="background:#0a1628"></span> Midnight</div>
                    <div class="theme-option" data-theme="ocean"><span class="theme-dot"
                            style="background:#0c2d48"></span> Ocean</div>
                    <div class="theme-option" data-theme="senai"><span class="theme-dot"
                            style="background:#dd203c"></span> SENAI Red</div>
                </div>
            </div>
            <button class="sidebar-btn" id="settings-btn" title="ConfiguraÃ§Ãµes IA">
                <i class="fas fa-sliders-h"></i>
            </button>
            <button class="sidebar-btn mobile-history-btn" id="mobile-history-btn" title="HistÃ³rico">
                <i class="fas fa-history"></i>
            </button>
            <button class="sidebar-btn" id="toggle-mode" title="Alternar tema">
                <i class="fas fa-moon"></i>
            </button>
        </div>
    </aside>

    <!-- Mobile History Drawer -->
    <div class="mobile-drawer-overlay" id="mobile-drawer-overlay">
        <div class="mobile-drawer">
            <div class="mobile-drawer-header">
                <h3><i class="fas fa-history"></i> Conversas</h3>
                <button class="settings-close" id="mobile-drawer-close"><i class="fas fa-times"></i></button>
            </div>
            <div class="chat-search-wrap">
                <i class="fas fa-search"></i>
                <input type="text" id="mobile-chat-search" placeholder="Buscar conversa..." autocomplete="off">
            </div>
            <div class="mobile-drawer-list" id="mobile-drawer-list">
                <!-- Populated dynamically -->
            </div>
            <div class="mobile-drawer-footer">
                <button class="settings-save" id="mobile-new-chat"><i class="fas fa-plus"></i> Nova Conversa</button>
            </div>
        </div>
    </div>

    <!-- Settings Panel -->
    <div class="settings-overlay" id="settings-overlay">
        <div class="settings-panel">
            <div class="settings-header">
                <h3><i class="fas fa-cog"></i> ConfiguraÃ§Ãµes da IA</h3>
                <button class="settings-close" id="settings-close"><i class="fas fa-times"></i></button>
            </div>

            <div class="settings-body">
                <!-- Provedor -->
                <div class="settings-group">
                    <label class="settings-label">Provedor de IA</label>
                    <select id="provider-select" class="settings-select">
                        <option value="gemini">Google Gemini</option>
                        <option value="openrouter">OpenRouter</option>
                    </select>
                </div>

                <!-- API Key -->
                <div class="settings-group">
                    <label class="settings-label">Chave de API</label>
                    <input type="password" id="api-key-input" class="settings-input"
                        placeholder="Cole sua API Key aqui...">
                    <small class="settings-hint" id="api-key-hint">Gemini: console.cloud.google.com | OpenRouter:
                        openrouter.ai</small>
                </div>

                <!-- URL Base (OpenRouter only) -->
                <div class="settings-group" id="openrouter-url-group" style="display:none">
                    <label class="settings-label">URL Base (OpenRouter)</label>
                    <input type="text" id="openrouter-url" class="settings-input"
                        value="https://openrouter.ai/api/v1/chat/completions"
                        placeholder="https://openrouter.ai/api/v1/chat/completions">
                </div>

                <!-- Senai TIERS -->
                <div class="settings-group">
                    <label class="settings-label">Senai TIERS (NÃ­vel da IA)</label>
                    <select id="tier-select" class="settings-select">
                        <option value="classic">âš¡ Classic SENAI â€” Mais rÃ¡pido, perguntas simples</option>
                        <option value="perfect" selected>ðŸŽ¯ Perfect SENAI â€” Equilibrado, dia a dia</option>
                        <option value="ultimate">ðŸš€ Ultimate SENAI â€” AvanÃ§ado, raciocÃ­nio e cÃ³digo</option>
                        <option value="ultra">ðŸ’Ž Ultra SENAI â€” O mais forte, resoluÃ§Ã£o complexa</option>
                    </select>
                </div>

                <!-- Modelo (auto-preenchido) -->
                <div class="settings-group">
                    <label class="settings-label">Modelo <small>(auto-preenchido pelo Tier)</small></label>
                    <input type="text" id="model-display" class="settings-input" readonly>
                </div>

                <!-- Buscar modelos free (OpenRouter) -->
                <div class="settings-group" id="fetch-models-group" style="display:none">
                    <button class="settings-save" id="fetch-models-btn" style="background:#6366f1">
                        <i class="fas fa-search"></i> Buscar Modelos Free (OpenRouter)
                    </button>
                    <div id="free-models-list" class="free-models-list"></div>
                </div>

                <!-- Temperatura -->
                <div class="settings-group">
                    <label class="settings-label">Temperatura: <span id="temp-value">0.7</span></label>
                    <input type="range" id="temp-slider" class="settings-range" min="0" max="2" step="0.1" value="0.7">
                    <div class="range-labels">
                        <span>Preciso</span>
                        <span>Criativo</span>
                    </div>
                </div>

                <!-- Personalidade -->
                <div class="settings-group">
                    <label class="settings-label">Personalidade do Assistente</label>
                    <div class="personality-grid">
                        <button class="personality-btn active" data-personality="padrao">
                            <i class="fas fa-robot"></i>
                            <span>PadrÃ£o</span>
                            <small>Educado e tÃ©cnico</small>
                        </button>
                        <button class="personality-btn" data-personality="casual">
                            <i class="fas fa-comments"></i>
                            <span>Casual</span>
                            <small>GÃ­rias e descontraÃ­do</small>
                        </button>
                        <button class="personality-btn" data-personality="tecnico">
                            <i class="fas fa-laptop-code"></i>
                            <span>TÃ©cnico</span>
                            <small>Foco em cÃ³digo e dados</small>
                        </button>
                        <button class="personality-btn" data-personality="professor">
                            <i class="fas fa-chalkboard-teacher"></i>
                            <span>Professor</span>
                            <small>DidÃ¡tico e explicativo</small>
                        </button>
                    </div>
                </div>

                <!-- Prompt personalizado -->
                <div class="settings-group">
                    <label class="settings-label">Prompt do Sistema (instruÃ§Ãµes personalizadas)</label>
                    <textarea id="custom-prompt" class="settings-textarea" rows="4"
                        placeholder="Escreva instruÃ§Ãµes personalizadas para a IA..."></textarea>
                    <small class="settings-hint">Deixe vazio para usar o prompt da personalidade selecionada</small>
                </div>

                <!-- Contexto Persistente -->
                <div class="settings-group">
                    <label class="settings-label">ðŸ“Œ Contexto Persistente <small>(vale para TODAS as
                            conversas)</small></label>
                    <textarea id="persistent-context" class="settings-textarea" rows="3"
                        placeholder="Ex: Sempre responda em portuguÃªs. Eu sou aluno de TDS no SENAI SP."></textarea>
                    <small class="settings-hint">Esta instruÃ§Ã£o serÃ¡ adicionada automaticamente a cada mensagem</small>
                </div>
            </div>

            <div class="settings-footer">
                <button class="settings-save" id="settings-save"><i class="fas fa-check"></i> Salvar</button>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <main class="main-content">

        <!-- Chat Messages Area -->
        <div class="chat-messages" id="chat-messages">
            <!-- Welcome Screen -->
            <div class="welcome" id="welcome">
                <div class="welcome-logo">
                    <img src="img/SENAI-AI 1.png" alt="INOVA SENAI Logo">
                    <div class="logo-glow"></div>
                </div>
                <h1 class="welcome-title">INOVA <span class="accent">SENAI</span></h1>
                <p class="welcome-subtitle">Como posso te ajudar hoje?</p>

                <div class="suggestion-cards">
                    <div class="suggestion-card" data-prompt="O que Ã© inteligÃªncia artificial?">
                        <i class="fas fa-lightbulb"></i>
                        <span>O que Ã© inteligÃªncia artificial?</span>
                    </div>
                    <div class="suggestion-card" data-prompt="Me explique sobre machine learning">
                        <i class="fas fa-brain"></i>
                        <span>Me explique sobre machine learning</span>
                    </div>
                    <div class="suggestion-card" data-prompt="Como funciona um chatbot?">
                        <i class="fas fa-robot"></i>
                        <span>Como funciona um chatbot?</span>
                    </div>
                    <div class="suggestion-card" data-prompt="Quais os cursos do SENAI?">
                        <i class="fas fa-graduation-cap"></i>
                        <span>Quais os cursos do SENAI?</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Scroll to Bottom Button -->
        <button class="scroll-bottom-btn" id="scroll-bottom" title="Ir ao final">
            <i class="fas fa-chevron-down"></i>
        </button>

        <!-- Input Area -->
        <div class="input-area">
            <!-- File Preview Strip -->
            <div class="file-preview-strip" id="file-preview-strip"></div>

            <div class="input-wrapper">
                <!-- Hidden file input -->
                <input type="file" id="file-input" multiple hidden>

                <button class="input-btn" id="attach-btn" title="Anexar arquivo">
                    <i class="fas fa-paperclip"></i>
                </button>
                <input type="text" name="prompt" id="prompt" placeholder="Escreva sua mensagem..." autocomplete="off">
                <div class="input-actions">
                    <button class="input-btn" id="webcam-btn" title="CÃ¢mera ao vivo">
                        <i class="fas fa-camera"></i>
                    </button>
                    <button class="input-btn" id="capture" title="Mensagem de voz">
                        <i class="fas fa-microphone"></i>
                    </button>
                    <button class="input-btn send-btn" id="send-btn" title="Enviar">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                    <button class="input-btn stop-btn" id="stop-btn" title="Parar geraÃ§Ã£o" style="display:none">
                        <i class="fas fa-stop"></i>
                    </button>
                </div>
            </div>
            <div class="disclaimer-row">
                <p class="disclaimer">INOVA SENAI pode gerar informaÃ§Ãµes imprecisas. Verifique as respostas importantes.
                </p>
                <span class="token-counter" id="token-counter" title="Estimativa de tokens na conversa">0 tokens</span>
            </div>
        </div>

    </main>

    <!-- Webcam Modal -->
    <div class="webcam-overlay" id="webcam-overlay">
        <div class="webcam-panel">
            <div class="webcam-header">
                <h3><i class="fas fa-camera"></i> CÃ¢mera ao Vivo</h3>
                <button class="settings-close" id="webcam-close"><i class="fas fa-times"></i></button>
            </div>
            <div class="webcam-body">
                <video id="webcam-video" autoplay playsinline></video>
                <canvas id="webcam-canvas" style="display:none"></canvas>
            </div>
            <div class="webcam-footer">
                <button class="webcam-capture-btn" id="webcam-capture">
                    <i class="fas fa-circle"></i> Capturar
                </button>
            </div>
        </div>
    </div>

    <!-- Prompt Templates Modal -->
    <div class="templates-overlay" id="templates-overlay">
        <div class="templates-panel">
            <div class="templates-header">
                <h3><i class="fas fa-magic"></i> Prompt Templates</h3>
                <button class="settings-close" id="templates-close"><i class="fas fa-times"></i></button>
            </div>
            <div class="templates-body">
                <div class="template-card"
                    data-template="Revise o seguinte cÃ³digo, identifique bugs, sugira melhorias de performance e boas prÃ¡ticas:">
                    <i class="fas fa-code"></i>
                    <div><strong>Revisar CÃ³digo</strong><br><small>Identifica bugs e sugere melhorias</small></div>
                </div>
                <div class="template-card"
                    data-template="Explique o conceito a seguir de forma didÃ¡tica, com exemplos prÃ¡ticos e analogias simples:">
                    <i class="fas fa-book"></i>
                    <div><strong>Explicar Conceito</strong><br><small>DidÃ¡tico com analogias</small></div>
                </div>
                <div class="template-card"
                    data-template="Crie um plano de estudos detalhado e organizado por semanas para aprender o seguinte tema:">
                    <i class="fas fa-calendar-alt"></i>
                    <div><strong>Plano de Estudos</strong><br><small>Organizado por semanas</small></div>
                </div>
                <div class="template-card"
                    data-template="Refatore o cÃ³digo abaixo seguindo os princÃ­pios SOLID, clean code e boas prÃ¡ticas:">
                    <i class="fas fa-tools"></i>
                    <div><strong>Refatorar CÃ³digo</strong><br><small>SOLID e clean code</small></div>
                </div>
                <div class="template-card"
                    data-template="Me ajude a debugar o seguinte erro. Explique a causa raiz e a soluÃ§Ã£o passo a passo:">
                    <i class="fas fa-bug"></i>
                    <div><strong>Debug de Erro</strong><br><small>Causa raiz + soluÃ§Ã£o</small></div>
                </div>
                <div class="template-card"
                    data-template="Escreva um e-mail profissional sobre o seguinte assunto. Tom formal e objetivo:">
                    <i class="fas fa-envelope"></i>
                    <div><strong>Escrever E-mail</strong><br><small>Profissional e formal</small></div>
                </div>
                <div class="template-card"
                    data-template="Resuma o seguinte texto em tÃ³picos principais, mantendo as informaÃ§Ãµes mais relevantes:">
                    <i class="fas fa-compress-alt"></i>
                    <div><strong>Resumir Texto</strong><br><small>TÃ³picos principais</small></div>
                </div>
                <div class="template-card"
                    data-template="Traduza o seguinte texto para portuguÃªs brasileiro, mantendo o tom e contexto original:">
                    <i class="fas fa-language"></i>
                    <div><strong>Traduzir Texto</strong><br><small>Para PT-BR</small></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Agents Modal -->
    <div class="templates-overlay" id="agents-overlay">
        <div class="templates-panel">
            <div class="templates-header">
                <h3><i class="fas fa-user-cog"></i> Agentes Especializados</h3>
                <button class="settings-close" id="agents-close"><i class="fas fa-times"></i></button>
            </div>
            <p style="padding: 0 20px; font-size: 0.82rem; color: var(--text-secondary);">Escolha um agente â€” ele
                configura automaticamente o sistema de prompt ideal para a tarefa.</p>
            <div class="templates-body">
                <div class="template-card agent-card" data-agent="codigo"
                    data-prompt="VocÃª Ã© um engenheiro de software sÃªnior especializado em programaÃ§Ã£o. Responda sempre com cÃ³digo limpo, comentado e seguindo boas prÃ¡ticas. Use exemplos prÃ¡ticos. Indique complexidade O(n). Sugira testes.">
                    <i class="fas fa-code" style="color:#3b82f6"></i>
                    <div><strong>Agente de CÃ³digo</strong><br><small>Engenheiro de software sÃªnior</small></div>
                </div>
                <div class="template-card agent-card" data-agent="redacao"
                    data-prompt="VocÃª Ã© um redator profissional e revisor de textos. Escreva com clareza, coesÃ£o e coerÃªncia. Adapte o tom conforme pedido. Corrija gramÃ¡tica e sugira melhorias de estilo.">
                    <i class="fas fa-pen-fancy" style="color:#f59e0b"></i>
                    <div><strong>Agente de RedaÃ§Ã£o</strong><br><small>Redator e revisor profissional</small></div>
                </div>
                <div class="template-card agent-card" data-agent="matematica"
                    data-prompt="VocÃª Ã© um professor de matemÃ¡tica paciente e didÃ¡tico. Resolva problemas passo a passo. Use fÃ³rmulas LaTeX quando apropriado. Explique cada etapa com clareza.">
                    <i class="fas fa-calculator" style="color:#06b6d4"></i>
                    <div><strong>Agente de MatemÃ¡tica</strong><br><small>Professor didÃ¡tico e paciente</small></div>
                </div>
                <div class="template-card agent-card" data-agent="pesquisa"
                    data-prompt="VocÃª Ã© um pesquisador acadÃªmico. ForneÃ§a informaÃ§Ãµes precisas e bem fundamentadas. Cite fontes quando possÃ­vel. Organize respostas em tÃ³picos com introduÃ§Ã£o e conclusÃ£o.">
                    <i class="fas fa-search-plus" style="color:#8b5cf6"></i>
                    <div><strong>Agente de Pesquisa</strong><br><small>Pesquisador acadÃªmico</small></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="index.js"></script>
    <script>
        // PWA Service Worker
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js').catch(() => { });
        }
    </script>
</body>

</html>